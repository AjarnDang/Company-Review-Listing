name: Deploy to Production

# ‡∏£‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ push ‡πÑ‡∏õ‡∏ó‡∏µ‡πà main branch ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
on:
  push:
    branches:
      - main
  
  # ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô GitHub UI
  workflow_dispatch:

jobs:
  deploy:
    name: üöÄ Deploy to Vercel
    runs-on: ubuntu-latest
    
    # ‡πÉ‡∏ä‡πâ environment ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô GitHub Settings)
    environment:
      name: production
      url: ${{ steps.deploy.outputs.url }}
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
      
      - name: üü¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: üì¶ Install dependencies
        run: npm ci
      
      # ‡∏£‡∏±‡∏ô lint ‡πÅ‡∏•‡∏∞ type check ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô deploy
      - name: üîç Pre-deploy checks
        run: |
          npm run lint
          npx tsc --noEmit
      
      - name: üèóÔ∏è Build project
        run: npm run build
        env:
          NEXT_TELEMETRY_DISABLED: 1
      
      # Deploy ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Vercel (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Vercel)
      # ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_ID ‡πÉ‡∏ô GitHub Secrets
      - name: üöÄ Deploy to Vercel
        id: deploy
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
      
      # ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Slack ‡∏´‡∏£‡∏∑‡∏≠ Discord (optional)
      # - name: üì¢ Notify deployment
      #   uses: 8398a7/action-slack@v3
      #   if: always()
      #   with:
      #     status: ${{ job.status }}
      #     webhook_url: ${{ secrets.SLACK_WEBHOOK }}

